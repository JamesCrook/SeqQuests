<div class="container center-container">
    <h1>Select Job Type</h1>
    <div id="job-buttons" class="centered-panel-content">
      <!-- Buttons will be generated here -->
    </div>
</div>
<script>
    // Since this is a partial, we wrap the initialization in a function
    // and rely on Lcars executing it, or we can self-execute if we are careful.
    // However, Lcars.executeScripts works by appending script tags.
    // So `document.addEventListener('DOMContentLoaded', ...)` is NOT going to work because DOMContentLoaded has already fired.

    // We define a function to init the buttons and then call it immediately.

    async function initJobSelection() {
        try {
            const response = await fetch('/api/job_types');
            if (response.ok) {
                const jobTypes = await response.json();
                const container = document.getElementById('job-buttons');
                if (!container) return; // Guard against element missing
                container.innerHTML = ''; // Clear existing

                jobTypes.forEach(jobType => {
                    const button = document.createElement('button');
                    button.className = 'job-button';
                    button.textContent = jobType.display_name;
                    button.onclick = () => createJob(jobType.id);
                    container.appendChild(button);
                });
            } else {
                console.error('Failed to fetch job types:', await response.text());
                addLog('Failed to fetch job types', 'error');
            }
        } catch (error) {
            console.error('Error fetching job types:', error);
            addLog(`Error fetching job types: ${error}`, 'error');
        }
    }

    async function createJob(jobType) {
        try {
            const response = await fetch('/api/job', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ job_type: jobType }),
            });
            if (response.ok) {
                const newJob = await response.json();

                // Success actions:
                addLog(`Job created: ${newJob.job_id} (${jobType})`);
                await refreshJobs(); // defined in app.js
                selectJob(newJob.job_id, jobType); // defined in app.js
                closeModal(); // defined in app.js

            } else {
                console.error('Failed to create job:', await response.text());
                addLog('Failed to create job', 'error');
            }
        } catch (error) {
            console.error('Error creating job:', error);
            addLog(`Error creating job: ${error}`, 'error');
        }
    }

    // Call init immediately
    initJobSelection();
</script>
