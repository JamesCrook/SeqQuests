<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Protein Sequence Match Explorer</title>
    <link rel="icon" href="./wheel.ico">
    <link rel="stylesheet" type="text/css" href="./style.css">
    <script src="./sw_support.js"></script>      
    <script src="./match_explorer.js"></script>
    <script src="./lcars.js"></script>
    <script src="./vector2d.js"></script>
    <script src="./help.js"></script>
</head>
<body class="app-root">
    <div class="container explorer-layout">
        <!-- Left Panel: Findings List -->
        <div class="panel-tight wide-400-more-or-less" id="LeftPanel"></div>

        <!-- Right Panel: Detail View (now includes Alignment) -->
        <div class="panel-tight wide-700-or-more" id="RightPanel"></div>
    </div>

    <script>
        const API_BASE_URL = window.location.origin; // Will use same origin as page
        const API_TIMEOUT = 5300; // milliseconds
        let isServerConnected = false;
        let usingRealFindings = false; // Track if we loaded real findings from server

        let currentHoveredEntry = null;
        //let isInitializing = false;
        let isLoadingSequence = false;
        let lastLoadedEntry = null;
     
        // Initialize on page load
        window.addEventListener('DOMContentLoaded', () => {
            const helpConfig = [
                {
                    items: [
                        {
                            text: '<strong>Match Explorer:</strong><br>For exploring alignments between proteins.',
                            targetId: 'page-title',
                            type: 'results'
                        },                    
                        {
                            text: '<strong>Menu:</strong><br>Click to get a menu of choices - such as other web pages to visit.',
                            targetId: 'hamburger-menu',
                            type: 'default'
                        },
                        {
                            text: '<strong>Status:</strong><br>Log in is not supported in this version',
                            targetId: 'statusDot',
                            type: 'results'
                        },
                        {
                            text: '<strong>Chooser:</strong><br>Choose the pair of proteins from this list.',
                            targetId: 'LeftPanel',
                            type: 'default'
                        },
                        {
                            text: '<strong>Details:</strong><br>View the alignment and protein files in this list.',
                            targetId: 'RightPanel',
                            type: 'results'
                        },                                                
                    ]
                },
                {
                    items: [
                        {
                            text: '<strong>Found Similarity:</strong><br>Click on the found similarity to view details in the detail panel.',
                            targetSelector: '.finding-entry',
                            type: 'default'
                        },
                        {
                            text: '<strong>Sources:</strong><br>Coose which source of similarities<ul><li>Distilled - About 20 chosen similarities</li><li>Standard - Similarities without strong sequence bias</li><li>Biased - Similairities with strong sequence bias</li></ul>',
                            targetId: 'sources',
                            type: 'default'
                        },
                        {
                            text: '<strong>Multiscroll:</strong><br>Click to enable or disable ganged <a href="/docs/tutorials/multiscroller.md">\'multiscroller\' scrolling</a>.<br>When it\'s ON, dragging either column will also move the other column.',
                            targetId: 'multiscrollBtn',
                            type: 'default'
                        },
                        {
                            text: '<strong>Count of entries:</strong><br>The number of protein pairs listed in this list.',
                            targetId: 'entriesCount',
                            type: 'results'
                        },
                        {
                            text: '<strong>Copy:</strong><br>Copies the names of the two proteins and their alignement to the clipboard. You can then paste into an editor.',
                            targetId: 'copyAlignmentBtn',
                            type: 'default'
                        }
                    ]
                }
            ];

            const menuConfig = [
                { label: 'Home', href: './index.html' },
                { type: 'divider' },
                { label: 'Help', action: DoDefaultHelp }
            ];
            new LcarsHeader("Protein Sequence Match Explorer", helpConfig, menuConfig);

            // Load partials using Lcars
            Promise.all([
                Lcars.loadPartial('LeftPanel', './panels/findings_list.html'),
                Lcars.loadPartial('RightPanel', './panels/detail_view.html')
            ]).then(() => {
                if (typeof window.initializeApp === 'function') {
                    window.initializeApp();
                }
            });
        });
    </script>
</body>
</html>