
<!DOCTYPE html>
<html>
<head>
    <title>Configure Sequence Search Job</title>
    <link rel="stylesheet" type="text/css" href="/static/style.css">
</head>
<body>
    <h2>Configure Sequence Search Job</h2>
    <form id="config-form">
        <label for="accession">Accession Number:</label>
        <input type="text" id="accession" name="accession">
        <br>
        <button type="button" onclick="saveConfig()">Save Configuration</button>
    </form>

    <hr>

    <h2>Job Progress</h2>
    <div id="progress-container">
        <p><strong>Sequences Examined:</strong> <span id="sequences-examined">0</span></p>
        <p><strong>Most Recent Item:</strong> <span id="most-recent-item">-</span></p>
        <h3>Last Ten Results:</h3>
        <ul id="last-ten-accepted">
        </ul>
    </div>

    <script src="/static/job_monitor.js"></script>
    <script>
        async function saveConfig() {
            const jobId = getJobIdFromUrl();
            const accession = document.getElementById('accession').value;

            const config = {
                accession: accession
            };

            try {
                await parent.apiCall(`/api/job/${jobId}/configure`, 'POST', { config });
                parent.addLog(`Configuration for job ${jobId} saved.`, 'success');
                parent.closeModal();
            } catch (e) {
                parent.addLog(`Failed to save configuration: ${e}`, 'error');
            }
        }

        function updateProgressDisplay(data) {
            document.getElementById('sequences-examined').textContent = data.sequences_examined || 0;
            document.getElementById('most-recent-item').textContent = data.most_recent_item || '-';

            const acceptedList = document.getElementById('last-ten-accepted');
            acceptedList.innerHTML = '';
            if (data.last_ten_accepted && data.last_ten_accepted.length > 0) {
                data.last_ten_accepted.forEach(item => {
                    const li = document.createElement('li');
                    li.textContent = item;
                    acceptedList.appendChild(li);
                });
            }
        }

        window.addEventListener('load', () => {
            loadJobConfig();
            pollJobStatus(updateProgressDisplay);
        });
    </script>
</body>
</html>
